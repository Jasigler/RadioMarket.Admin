<app-frame></app-frame>
<section class="section">
	<div class="container">
		<h1 class="title">Radiomarket Categories</h1>
		<hr />
	</div>
</section>
<section class="section">
	<nav class="level">
		<div class="level-left">
			<div class="level-item add-category-level">
				<p class="subtitle is-5">Add Category</p>
			</div>
			<div class="level-item">
				<fa-icon class="fa-lg" [icon]="addSymbol" (click)="openAddModal()"></fa-icon>
			</div>
		</div>
		<div class="level-right">

		</div>
	</nav>
	<section class="section">
		<div class="container">
			<hr>
			<div class="card" *ngFor="let category of categories | parent">
				<div class="card-image">
					<p>{{category.name}}</p>
					<figure class="image is-128x128">
						<img src="{{getCategoryImage(category.category_id)}}">
					</figure>
				</div>

			</div>
			<!-- <table class="table is-fullwidth">
				<thead>
					<tr>
						<th><abbr title="Edit">Edit</abbr></th>
						<th><abbr title="Id">Id</abbr></th>
						<th><abbr title="Name">Name</abbr></th>
						<th><abbr title="Parent">Parent</abbr></th>
						<th><abbr title="Active">Active</abbr></th>
					</tr>
				</thead>
				<tr *ngFor="let category of categories | async">
					<td
						class="has-text-info-dark"
						(click)="setCategoryInfo(category)"
						(click)="openEditModal()"
					>
						<fa-icon class="editButton" [icon]="editSymbol"></fa-icon>
					</td>
					<td>{{ category?.category_id }}</td>
					<td>{{ category?.name }}</td>
					<td>{{ category?.parent_id }}</td>
					<td>{{ category?.is_active }}</td>
				</tr>
			</table> -->
		</div>
	</section>
	<div class="modal edit-modal" [ngClass]="{ 'is-active': editModalOpen }">
		<div class="modal-background"></div>
		<div class="modal-card">
			<header class="modal-card-head">
				<p class="modal-card-title">Category Editor</p>
			</header>
			<section class="modal-card-body">
				<p class="subtitle is-6">
					Warning: Deactivating a parent category will recursively deactivate all sub-categories.
				</p>
				<form [formGroup]="editForm">
					<div class="field is-horizontal">
						<div class="field-label is-normal">
							<label class="label">Name</label>
						</div>
						<div class="field-body">
							<div class="field">
								<div class="control">
									<input
										class="input"
										type="text"
										value="{{ currentCategory?.name }}"
										formControlName="name"
									/>
								</div>
							</div>
						</div>
					</div>
					<div class="field is-horizontal">
						<div class="field-label is-normal">
							<label class="label">Parent ID</label>
						</div>
						<div class="field-body">
							<div class="field">
								<div class="control">
									<input
										class="input"
										type="text"
										value="{{ currentCategory?.parent_id }}"
										formControlName="parent"
									/>
								</div>
							</div>
						</div>
					</div>
					<div class="field is-horizontal">
						<div class="field-label is-normal">
							<label class="label">Is Active</label>
						</div>
						<div class="field-body">
							<div class="field">
								<div class="control">
									<input
										class="input"
										type="text"
										value="{{ currentCategory?.is_active }}"
										formControlName="active"
									/>
								</div>
							</div>
						</div>
					</div>
				</form>
			</section>
			<footer class="modal-card-foot">
				<button class="button is-success" (click)="updateCategory()">Save changes</button>
				<button class="button" (click)="closeEditModal()">Cancel</button>
				<progress class="progress is-small is-primary" max="100" *ngIf="addModalOpen"> </progress>
			</footer>
		</div>
	</div>
	<div class="modal add-modal" [ngClass]="{ 'is-active': addModalOpen }">
		<div class="modal-background"></div>
		<div class="modal-card">
			<header class="modal-card-head">
				<p class="modal-card-title">Add New Category</p>
			</header>
			<section class="modal-card-body">
				<form [formGroup]="addForm">
					<div class="field is-horizontal">
						<div class="field-label is-normal">
							<label class="label">Name</label>
						</div>
						<div class="field-body">
							<div class="field">
								<div class="control">
									<input
										class="input"
										type="text"
										placeholder="Name: string"
										formControlName="name"
										required
									/>
								</div>
							</div>
						</div>
					</div>
					<div class="field is-horizontal">
						<div class="field-label is-normal">
							<label class="label">Parent ID</label>
						</div>
						<div class="field-body">
							<div class="field">
								<div class="control">
									<input
										class="input"
										type="text"
										placeholder="ParentId: int"	
										formControlName="parent"
									/>
								</div>
							</div>
						</div>
					</div>
					<div class="field is-horizontal">
						<div class="field-label is-normal">
							<label class="label">Is Active</label>
						</div>
						<div class="field-body">
							<div class="field">
								<div class="control">
									<input
										class="input"
										type="text"
										placeholder="Active: boolean"
										formControlName="active"
										required
									/>
								</div>
							</div>
						</div>
					</div>
				</form>
			</section>
			<footer class="modal-card-foot">
				<button class="button is-success" (click)="addCategory()">Save changes</button>
				<button class="button" (click)="closeAddModal()">Cancel</button>
				<progress class="progress is-small is-primary" max="100" *ngIf="isWorking"> </progress>
			</footer>
		</div>
	</div>
</section>
